// Generated by CoffeeScript 1.6.3
var filter, settings;

settings = {
  active: true
};

console.log('content');

chrome.runtime.onMessage.addListener(function(request, sender, sendResponse) {
  console.log('content msg', request);
  if (request.type === "reFilter") {
    settings.filter = request.filter;
    filter();
  }
  return sendResponse({
    status: "ok"
  });
});

$(function() {
  return chrome.runtime.sendMessage({
    type: "getSettings"
  }, function(set) {
    console.log("content settings", set);
    settings = set;
    if (settings.enabled) {
      return filter();
    }
  });
});

filter = function() {
  var text;
  text = settings.filter;
  console.log('filtering by', text);
  $('[data-txt]').each(function(i, e) {
    return $(e).text($(e).attr('data-txt')).removeAttr('data-txt').removeClass('filter');
  });
  return $("a:contains('" + text + "'),p:contains('" + text + "'),span:contains('" + text + "'),td:contains('" + text + "'),th:contains('" + text + "')").each(function(i, e) {
    return $(e).attr('data-txt', $(e).text()).text('KABOOM').addClass('filter');
  });
};
